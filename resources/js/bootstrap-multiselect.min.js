!function($){"use strict";if(typeof ko!=='undefined'&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect){ko.bindingHandlers.multiselect={after:['options','value','selectedOptions'],init:function(b,c,d,e,f){var g=$(b);var h=ko.toJS(c());g.multiselect(h);if(d.has('options')){var i=d.get('options');if(ko.isObservable(i)){ko.computed({read:function(){i();setTimeout(function(){var a=g.data('multiselect');if(a)a.updateOriginalOptions();g.multiselect('rebuild')},1)},disposeWhenNodeIsRemoved:b})}}if(d.has('value')){var j=d.get('value');if(ko.isObservable(j)){ko.computed({read:function(){j();setTimeout(function(){g.multiselect('refresh')},1)},disposeWhenNodeIsRemoved:b}).extend({rateLimit:100,notifyWhenChangesStop:true})}}if(d.has('selectedOptions')){var k=d.get('selectedOptions');if(ko.isObservable(k)){ko.computed({read:function(){k();setTimeout(function(){g.multiselect('refresh')},1)},disposeWhenNodeIsRemoved:b}).extend({rateLimit:100,notifyWhenChangesStop:true})}}ko.utils.domNodeDisposal.addDisposeCallback(b,function(){g.multiselect('destroy')})},update:function(a,b,c,d,e){var f=$(a);var g=ko.toJS(b());f.multiselect('setOptions',g);f.multiselect('rebuild')}}}function forEach(a,b){for(var c=0;c<a.length;++c){b(a[c],c)}}function Multiselect(a,b){this.$select=$(a);this.options=this.mergeOptions($.extend({},b,this.$select.data()));this.originalOptions=this.$select.clone()[0].options;this.query='';this.searchTimeout=null;this.lastToggledInput=null this.options.multiple=this.$select.attr('multiple')==="multiple";this.options.onChange=$.proxy(this.options.onChange,this);this.options.onDropdownShow=$.proxy(this.options.onDropdownShow,this);this.options.onDropdownHide=$.proxy(this.options.onDropdownHide,this);this.options.onDropdownShown=$.proxy(this.options.onDropdownShown,this);this.options.onDropdownHidden=$.proxy(this.options.onDropdownHidden,this);this.buildContainer();this.buildButton();this.buildDropdown();this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();if(this.options.disableIfEmpty&&$('option',this.$select).length<=0){this.disable()}this.$select.hide().after(this.$container)};Multiselect.prototype={defaults:{buttonText:function(b,c){if(b.length===0){return this.nonSelectedText}else if(this.allSelectedText&&b.length==$('option',$(c)).length){if(this.selectAllNumber){return this.allSelectedText+' ('+b.length+')'}else{return this.allSelectedText}}else if(b.length>this.numberDisplayed){return b.length+' '+this.nSelectedText}else{var d='';b.each(function(){var a=($(this).attr('label')!==undefined)?$(this).attr('label'):$(this).text();d+=a+', '});return d.substr(0,d.length-2)}},buttonTitle:function(a,b){if(a.length===0){return this.nonSelectedText}else{var c='';a.each(function(){c+=$(this).text()+', '});return c.substr(0,c.length-2)}},optionLabel:function(a){return $(a).attr('label')||$(a).text()},onChange:function(a,b){},onDropdownShow:function(a){},onDropdownHide:function(a){},onDropdownShown:function(a){},onDropdownHidden:function(a){},onSelectAll:function(){},buttonClass:'btn btn-default',inheritClass:false,buttonWidth:'auto',buttonContainer:'<div class="btn-group" />',dropRight:false,selectedClass:'active',maxHeight:false,checkboxName:false,includeSelectAllOption:false,includeSelectAllIfMoreThan:0,selectAllText:' Select all',selectAllValue:'multiselect-all',selectAllName:false,selectAllNumber:true,enableFiltering:false,enableCaseInsensitiveFiltering:false,enableClickableOptGroups:false,filterPlaceholder:'Search',filterBehavior:'text',includeFilterClearBtn:true,preventInputChangeEvent:false,nonSelectedText:'None selected',nSelectedText:'selected',allSelectedText:'All selected',numberDisplayed:3,disableIfEmpty:false,templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret"></b></button>',ul:'<ul class="multiselect-container dropdown-menu"></ul>',filter:'<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text"></div></li>',filterClearBtn:'<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"></i></button></span>',li:'<li><a tabindex="0"><label></label></a></li>',divider:'<li class="multiselect-item divider"></li>',liGroup:'<li class="multiselect-item multiselect-group"><label></label></li>'}},constructor:Multiselect,buildContainer:function(){this.$container=$(this.options.buttonContainer);this.$container.on('show.bs.dropdown',this.options.onDropdownShow);this.$container.on('hide.bs.dropdown',this.options.onDropdownHide);this.$container.on('shown.bs.dropdown',this.options.onDropdownShown);this.$container.on('hidden.bs.dropdown',this.options.onDropdownHidden)},buildButton:function(){this.$button=$(this.options.templates.button).addClass(this.options.buttonClass);if(this.$select.attr('class')&&this.options.inheritClass){this.$button.addClass(this.$select.attr('class'))}if(this.$select.prop('disabled')){this.disable()}else{this.enable()}if(this.options.buttonWidth&&this.options.buttonWidth!=='auto'){this.$button.css({'width':this.options.buttonWidth,'overflow':'hidden','text-overflow':'ellipsis'});this.$container.css({'width':this.options.buttonWidth})}var a=this.$select.attr('tabindex');if(a){this.$button.attr('tabindex',a)}this.$container.prepend(this.$button)},buildDropdown:function(){this.$ul=$(this.options.templates.ul);if(this.options.dropRight){this.$ul.addClass('pull-right')}if(this.options.maxHeight){this.$ul.css({'max-height':this.options.maxHeight+'px','overflow-y':'auto','overflow-x':'hidden'})}this.$container.append(this.$ul)},buildDropdownOptions:function(){this.$select.children().each($.proxy(function(a,b){var c=$(b);var d=c.prop('tagName').toLowerCase();if(c.prop('value')===this.options.selectAllValue){return}if(d==='optgroup'){this.createOptgroup(b)}else if(d==='option'){if(c.data('role')==='divider'){this.createDivider()}else{this.createOptionValue(b)}}},this));$('li input',this.$ul).on('change',$.proxy(function(a){var b=$(a.target);var c=b.prop('checked')||false;var d=b.val()===this.options.selectAllValue;if(this.options.selectedClass){if(c){b.closest('li').addClass(this.options.selectedClass)}else{b.closest('li').removeClass(this.options.selectedClass)}}var e=b.val();var f=this.getOptionByValue(e);var g=$('option',this.$select).not(f);var h=$('input',this.$container).not(b);if(d){if(c){this.selectAll()}else{this.deselectAll()}}if(!d){if(c){f.prop('selected',true);if(this.options.multiple){f.prop('selected',true)}else{if(this.options.selectedClass){$(h).closest('li').removeClass(this.options.selectedClass)}$(h).prop('checked',false);g.prop('selected',false);this.$button.click()}if(this.options.selectedClass==="active"){g.closest("a").css("outline","")}}else{f.prop('selected',false)}}this.$select.change();this.updateButtonText();this.updateSelectAll();this.options.onChange(f,c);if(this.options.preventInputChangeEvent){return false}},this));$('li a',this.$ul).on('mousedown',function(e){if(e.shiftKey){return false}});$('li a',this.$ul).on('touchstart click',$.proxy(function(a){a.stopPropagation();var b=$(a.target);if(a.shiftKey&&this.options.multiple){if(b.is("label")){a.preventDefault();b=b.find("input");b.prop("checked",!b.prop("checked"))}var c=b.prop('checked')||false;if(this.lastToggledInput!==null&&this.lastToggledInput!==b){var d=b.closest("li").index();var e=this.lastToggledInput.closest("li").index();if(d>e){var f=e;e=d;d=f}++e;var g=this.$ul.find("li").slice(d,e).find("input");g.prop('checked',c);if(this.options.selectedClass){g.closest('li').toggleClass(this.options.selectedClass,c)}for(var i=0,j=g.length;i<j;i++){var h=$(g[i]);var k=this.getOptionByValue(h.val());k.prop('selected',c)}}b.trigger("change")}if(b.is("input")&&!b.closest("li").is(".multiselect-item")){this.lastToggledInput=b}b.blur()},this));this.$container.off('keydown.multiselect').on('keydown.multiselect',$.proxy(function(a){if($('input[type="text"]',this.$container).is(':focus')){return}if(a.keyCode===9&&this.$container.hasClass('open')){this.$button.click()}else{var b=$(this.$container).find("li:not(.divider):not(.disabled) a").filter(":visible");if(!b.length){return}var c=b.index(b.filter(':focus'));if(a.keyCode===38&&c>0){c--}else if(a.keyCode===40&&c<b.length-1){c++}else if(!~c){c=0}var d=b.eq(c);d.focus();if(a.keyCode===32||a.keyCode===13){var e=d.find('input');e.prop("checked",!e.prop("checked"));e.change()}a.stopPropagation();a.preventDefault()}},this));if(this.options.enableClickableOptGroups&&this.options.multiple){$('li.multiselect-group',this.$ul).on('click',$.proxy(function(a){a.stopPropagation();var b=$(a.target).parent();var c=b.nextUntil('li.multiselect-group');var d=c.filter(":visible");var e=true;var f=d.find('input');f.each(function(){e=e&&$(this).prop('checked')});f.prop('checked',!e).trigger('change')},this))}},createOptionValue:function(a){var b=$(a);if(b.is(':selected')){b.prop('selected',true)}var c=this.options.optionLabel(a);var d=b.val();var e=this.options.multiple?"checkbox":"radio";var f=$(this.options.templates.li);var g=$('label',f);g.addClass(e);var h=$('<input/>').attr('type',e);if(this.options.checkboxName){h.attr('name',this.options.checkboxName)}g.append(h);var i=b.prop('selected')||false;h.val(d);if(d===this.options.selectAllValue){f.addClass("multiselect-item multiselect-all");h.parent().parent().addClass('multiselect-all')}g.append(" "+c);g.attr('title',b.attr('title'));this.$ul.append(f);if(b.is(':disabled')){h.attr('disabled','disabled').prop('disabled',true).closest('a').attr("tabindex","-1").closest('li').addClass('disabled')}h.prop('checked',i);if(i&&this.options.selectedClass){h.closest('li').addClass(this.options.selectedClass)}},createDivider:function(a){var b=$(this.options.templates.divider);this.$ul.append(b)},createOptgroup:function(c){var d=$(c).prop('label');var e=$(this.options.templates.liGroup);$('label',e).text(d);if(this.options.enableClickableOptGroups){e.addClass('multiselect-group-clickable')}this.$ul.append(e);if($(c).is(':disabled')){e.addClass('disabled')}$('option',c).each($.proxy(function(a,b){this.createOptionValue(b)},this))},buildSelectAll:function(){if(typeof this.options.selectAllValue==='number'){this.options.selectAllValue=this.options.selectAllValue.toString()}var a=this.hasSelectAll();if(!a&&this.options.includeSelectAllOption&&this.options.multiple&&$('option',this.$select).length>this.options.includeSelectAllIfMoreThan){if(this.options.includeSelectAllDivider){this.$ul.prepend($(this.options.templates.divider))}var b=$(this.options.templates.li);$('label',b).addClass("checkbox");if(this.options.selectAllName){$('label',b).append('<input type="checkbox" name="'+this.options.selectAllName+'" />')}else{$('label',b).append('<input type="checkbox" />')}var c=$('input',b);c.val(this.options.selectAllValue);b.addClass("multiselect-item multiselect-all");c.parent().parent().addClass('multiselect-all');$('label',b).append(" "+this.options.selectAllText);this.$ul.prepend(b);c.prop('checked',false)}},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var i=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find('option').length>=i){this.$filter=$(this.options.templates.filter);$('input',this.$filter).attr('placeholder',this.options.filterPlaceholder);if(this.options.includeFilterClearBtn){var j=$(this.options.templates.filterClearBtn);j.on('click',$.proxy(function(a){clearTimeout(this.searchTimeout);this.$filter.find('.multiselect-search').val('');$('li',this.$ul).show().removeClass("filter-hidden");this.updateSelectAll()},this));this.$filter.find('.input-group').append(j)}this.$ul.prepend(this.$filter);this.$filter.val(this.query).on('click',function(a){a.stopPropagation()}).on('input keydown',$.proxy(function(h){if(h.which===13){h.preventDefault()}clearTimeout(this.searchTimeout);this.searchTimeout=this.asyncFunction($.proxy(function(){if(this.query!==h.target.value){this.query=h.target.value;var g,currentGroupVisible;$.each($('li',this.$ul),$.proxy(function(a,b){var c=$('input',b).length>0?$('input',b).val():"";var d=$('label',b).text();var e='';if((this.options.filterBehavior==='text')){e=d}else if((this.options.filterBehavior==='value')){e=c}else if(this.options.filterBehavior==='both'){e=d+'\n'+c}if(c!==this.options.selectAllValue&&d){var f=false;if(this.options.enableCaseInsensitiveFiltering&&e.toLowerCase().indexOf(this.query.toLowerCase())>-1){f=true}else if(e.indexOf(this.query)>-1){f=true}$(b).toggle(f).toggleClass('filter-hidden',!f);if($(b).hasClass('multiselect-group')){g=b;currentGroupVisible=f}else{if(f){$(g).show().removeClass('filter-hidden')}if(!f&&currentGroupVisible){$(b).show().removeClass('filter-hidden')}}}},this))}this.updateSelectAll()},this),300,this)},this))}}},destroy:function(){this.$container.remove();this.$select.show();this.$select.data('multiselect',null)},refresh:function(){$('option',this.$select).each($.proxy(function(a,b){var c=$('li input',this.$ul).filter(function(){return $(this).val()===$(b).val()});if($(b).is(':selected')){c.prop('checked',true);if(this.options.selectedClass){c.closest('li').addClass(this.options.selectedClass)}}else{c.prop('checked',false);if(this.options.selectedClass){c.closest('li').removeClass(this.options.selectedClass)}}if($(b).is(":disabled")){c.attr('disabled','disabled').prop('disabled',true).closest('li').addClass('disabled')}else{c.prop('disabled',false).closest('li').removeClass('disabled')}},this));this.updateButtonText();this.updateSelectAll()},select:function(a,b){if(!$.isArray(a)){a=[a]}for(var i=0;i<a.length;i++){var c=a[i];if(c===null||c===undefined){continue}var d=this.getOptionByValue(c);var e=this.getInputByValue(c);if(d===undefined||e===undefined){continue}if(!this.options.multiple){this.deselectAll(false)}if(this.options.selectedClass){e.closest('li').addClass(this.options.selectedClass)}e.prop('checked',true);d.prop('selected',true)}this.updateButtonText();this.updateSelectAll();if(b&&a.length===1){this.options.onChange(d,true)}},clearSelection:function(){this.deselectAll(false);this.updateButtonText();this.updateSelectAll()},deselect:function(a,b){if(!$.isArray(a)){a=[a]}for(var i=0;i<a.length;i++){var c=a[i];if(c===null||c===undefined){continue}var d=this.getOptionByValue(c);var e=this.getInputByValue(c);if(d===undefined||e===undefined){continue}if(this.options.selectedClass){e.closest('li').removeClass(this.options.selectedClass)}e.prop('checked',false);d.prop('selected',false)}this.updateButtonText();this.updateSelectAll();if(b&&a.length===1){this.options.onChange(d,false)}},selectAll:function(b,c){var b=typeof b==='undefined'?true:b;var d=$("li input[type='checkbox']:enabled",this.$ul);var e=d.filter(":visible");var f=d.length;var g=e.length;if(b){e.prop('checked',true);$("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").addClass(this.options.selectedClass)}else{d.prop('checked',true);$("li:not(.divider):not(.disabled)",this.$ul).addClass(this.options.selectedClass)}if(f===g||b===false){$("option:enabled",this.$select).prop('selected',true)}else{var h=e.map(function(){return $(this).val()}).get();$("option:enabled",this.$select).filter(function(a){return $.inArray($(this).val(),h)!==-1}).prop('selected',true)}if(c){this.options.onSelectAll()}},deselectAll:function(b){var b=typeof b==='undefined'?true:b;if(b){var c=$("li input[type='checkbox']:not(:disabled)",this.$ul).filter(":visible");c.prop('checked',false);var d=c.map(function(){return $(this).val()}).get();$("option:enabled",this.$select).filter(function(a){return $.inArray($(this).val(),d)!==-1}).prop('selected',false);if(this.options.selectedClass){$("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").removeClass(this.options.selectedClass)}}else{$("li input[type='checkbox']:enabled",this.$ul).prop('checked',false);$("option:enabled",this.$select).prop('selected',false);if(this.options.selectedClass){$("li:not(.divider):not(.disabled)",this.$ul).removeClass(this.options.selectedClass)}}},rebuild:function(){this.$ul.html('');this.options.multiple=this.$select.attr('multiple')==="multiple";this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();if(this.options.disableIfEmpty&&$('option',this.$select).length<=0){this.disable()}else{this.enable()}if(this.options.dropRight){this.$ul.addClass('pull-right')}},dataprovider:function(e){var f=0;var g=this.$select.empty();$.each(e,function(b,c){var d;if($.isArray(c.children)){f++;d=$('<optgroup/>').attr({label:c.label||'Group '+f,disabled:!!c.disabled});forEach(c.children,function(a){d.append($('<option/>').attr({value:a.value,label:a.label||a.value,title:a.title,selected:!!a.selected,disabled:!!a.disabled}))})}else{d=$('<option/>').attr({value:c.value,label:c.label||c.value,title:c.title,selected:!!c.selected,disabled:!!c.disabled})}g.append(d)});this.rebuild()},enable:function(){this.$select.prop('disabled',false);this.$button.prop('disabled',false).removeClass('disabled')},disable:function(){this.$select.prop('disabled',true);this.$button.prop('disabled',true).addClass('disabled')},setOptions:function(a){this.options=this.mergeOptions(a)},mergeOptions:function(a){return $.extend(true,{},this.defaults,this.options,a)},hasSelectAll:function(){return $('li.'+this.options.selectAllValue,this.$ul).length>0},updateSelectAll:function(){if(this.hasSelectAll()){var a=$("li:not(.multiselect-item):not(.filter-hidden) input:enabled",this.$ul);var b=a.length;var c=a.filter(":checked").length;var d=$("li."+this.options.selectAllValue,this.$ul);var e=d.find("input");if(c>0&&c===b){e.prop("checked",true);d.addClass(this.options.selectedClass);this.options.onSelectAll()}else{e.prop("checked",false);d.removeClass(this.options.selectedClass)}}},updateButtonText:function(){var a=this.getSelected();$('.multiselect .multiselect-selected-text',this.$container).text(this.options.buttonText(a,this.$select));$('.multiselect',this.$container).attr('title',this.options.buttonTitle(a,this.$select))},getSelected:function(){return $('option',this.$select).filter(":selected")},getOptionByValue:function(a){var b=$('option',this.$select);var c=a.toString();for(var i=0;i<b.length;i=i+1){var d=b[i];if(d.value===c){return $(d)}}},getInputByValue:function(a){var b=$('li input',this.$ul);var c=a.toString();for(var i=0;i<b.length;i=i+1){var d=b[i];if(d.value===c){return $(d)}}},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(a,b,c){var d=Array.prototype.slice.call(arguments,3);return setTimeout(function(){a.apply(c||window,d)},b)},setAllSelectedText:function(a){this.options.allSelectedText=a;this.updateButtonText()}};$.fn.multiselect=function(c,d,e){return this.each(function(){var a=$(this).data('multiselect');var b=typeof c==='object'&&c;if(!a){a=new Multiselect(this,b);$(this).data('multiselect',a)}if(typeof c==='string'){a[c](d,e);if(c==='destroy'){$(this).data('multiselect',false)}}})};$.fn.multiselect.Constructor=Multiselect;$(function(){$("select[data-role=multiselect]").multiselect()})}(window.jQuery);